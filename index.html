<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Financeiro - Google Sheets</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and React DOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { TrendingUp, TrendingDown, DollarSign, Calendar, Plus, RefreshCw } = lucide;

        const FinancialDashboard = () => {
            const [transactions, setTransactions] = useState([]);
            const [summary, setSummary] = useState({ income: 0, expenses: 0, balance: 0 });
            const [loading, setLoading] = useState(false);
            const [newTransaction, setNewTransaction] = useState({
                description: '',
                amount: '',
                type: 'expense',
                category: '',
                date: new Date().toISOString().split('T')[0]
            });

            // ⚠️ CONFIGURAÇÕES - ALTERE AQUI!
            const SHEET_ID = '1prVtG6HsY9Ju0AxEzd7tZrLWO4ZBb_zk8rA23FCYsOg';
            const API_KEY = 'SUA_API_KEY_AQUI'; // 👈 SUBSTITUA PELA SUA API KEY
            const RANGE = 'Página1!A:E'; // 👈 AJUSTE CONFORME SUA PLANILHA

            // Função para buscar dados do Google Sheets
            const fetchDataFromSheets = async () => {
                if (API_KEY === 'SUA_API_KEY_AQUI') {
                    alert('⚠️ Configure sua API Key primeiro!\nEdite o arquivo e substitua "SUA_API_KEY_AQUI" pela sua chave da Google Sheets API.');
                    return;
                }

                setLoading(true);
                try {
                    const response = await fetch(
                        `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Erro ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    const rows = data.values || [];
                    
                    if (rows.length === 0) {
                        console.log('Nenhum dado encontrado na planilha');
                        return;
                    }
                    
                    // Assumindo que a primeira linha são os cabeçalhos
                    const headers = rows[0];
                    console.log('Cabeçalhos encontrados:', headers);
                    
                    const transactionData = rows.slice(1).map((row, index) => ({
                        id: index + 1,
                        date: row[0] || '',
                        description: row[1] || '',
                        amount: parseFloat(row[2]?.toString().replace(/[^\d.-]/g, '')) || 0,
                        type: row[3]?.toLowerCase() || 'expense',
                        category: row[4] || 'Outros'
                    })).filter(t => t.amount !== 0 && t.description);
                    
                    console.log('Dados processados:', transactionData);
                    
                    setTransactions(transactionData);
                    calculateSummary(transactionData);
                    
                } catch (error) {
                    console.error('Erro detalhado:', error);
                    alert(`Erro ao carregar dados da planilha:\n${error.message}\n\nVerifique:\n1. Se a API Key está correta\n2. Se a planilha está pública\n3. Se o range está correto`);
                } finally {
                    setLoading(false);
                }
            };

            // Calcular resumo financeiro
            const calculateSummary = (data) => {
                const income = data
                    .filter(t => t.type === 'receita' || t.type === 'income' || t.amount > 0 && (t.type === 'receita' || t.type === 'income'))
                    .reduce((sum, t) => sum + Math.abs(t.amount), 0);
                
                const expenses = data
                    .filter(t => t.type === 'despesa' || t.type === 'expense' || (t.amount < 0))
                    .reduce((sum, t) => sum + Math.abs(t.amount), 0);
                
                setSummary({
                    income,
                    expenses,
                    balance: income - expenses
                });
            };

            // Função para adicionar nova transação
            const addTransaction = async () => {
                if (!newTransaction.description || !newTransaction.amount) {
                    alert('Preencha todos os campos obrigatórios');
                    return;
                }

                // Aqui você adicionaria a lógica para salvar na planilha
                // Por enquanto, vamos apenas mostrar uma mensagem
                alert(`Para adicionar automaticamente à planilha, você precisa:\n\n1. Criar um Google Apps Script\n2. Ou adicionar manualmente na planilha\n\nTransação: ${newTransaction.description} - R$ ${newTransaction.amount}`);
                
                // Limpar formulário
                setNewTransaction({
                    description: '',
                    amount: '',
                    type: 'expense',
                    category: '',
                    date: new Date().toISOString().split('T')[0]
                });
            };

            // Carregar dados ao montar o componente
            useEffect(() => {
                fetchDataFromSheets();
            }, []);

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(Math.abs(value));
            };

            const formatDate = (dateString) => {
                try {
                    // Tenta diferentes formatos de data
                    let date;
                    if (dateString.includes('/')) {
                        const parts = dateString.split('/');
                        date = new Date(parts[2], parts[1] - 1, parts[0]);
                    } else {
                        date = new Date(dateString);
                    }
                    return date.toLocaleDateString('pt-BR');
                } catch {
                    return dateString;
                }
            };

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4"
            }, 
                React.createElement('div', {
                    className: "max-w-6xl mx-auto space-y-6"
                },
                    
                    // Header
                    React.createElement('div', {
                        className: "text-center py-8"
                    },
                        React.createElement('h1', {
                            className: "text-4xl font-bold text-gray-800 mb-2"
                        }, "Dashboard Financeiro"),
                        React.createElement('p', {
                            className: "text-gray-600"
                        }, "Conectado ao Google Sheets"),
                        React.createElement('button', {
                            onClick: fetchDataFromSheets,
                            disabled: loading,
                            className: "mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto"
                        },
                            React.createElement(RefreshCw, {
                                className: `w-4 h-4 ${loading ? 'loading-spinner' : ''}`
                            }),
                            "Atualizar Dados"
                        )
                    ),

                    // Cards de Resumo
                    React.createElement('div', {
                        className: "grid grid-cols-1 md:grid-cols-3 gap-6"
                    },
                        React.createElement('div', {
                            className: "bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500"
                        },
                            React.createElement('div', {
                                className: "flex items-center justify-between"
                            },
                                React.createElement('div', {},
                                    React.createElement('p', {
                                        className: "text-gray-600 text-sm font-medium"
                                    }, "Receitas"),
                                    React.createElement('p', {
                                        className: "text-2xl font-bold text-green-600"
                                    }, formatCurrency(summary.income))
                                ),
                                React.createElement(TrendingUp, {
                                    className: "w-8 h-8 text-green-500"
                                })
                            )
                        ),

                        React.createElement('div', {
                            className: "bg-white rounded-xl shadow-lg p-6 border-l-4 border-red-500"
                        },
                            React.createElement('div', {
                                className: "flex items-center justify-between"
                            },
                                React.createElement('div', {},
                                    React.createElement('p', {
                                        className: "text-gray-600 text-sm font-medium"
                                    }, "Despesas"),
                                    React.createElement('p', {
                                        className: "text-2xl font-bold text-red-600"
                                    }, formatCurrency(summary.expenses))
                                ),
                                React.createElement(TrendingDown, {
                                    className: "w-8 h-8 text-red-500"
                                })
                            )
                        ),

                        React.createElement('div', {
                            className: "bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500"
                        },
                            React.createElement('div', {
                                className: "flex items-center justify-between"
                            },
                                React.createElement('div', {},
                                    React.createElement('p', {
                                        className: "text-gray-600 text-sm font-medium"
                                    }, "Saldo"),
                                    React.createElement('p', {
                                        className: `text-2xl font-bold ${summary.balance >= 0 ? 'text-blue-600' : 'text-red-600'}`
                                    }, formatCurrency(summary.balance))
                                ),
                                React.createElement(DollarSign, {
                                    className: "w-8 h-8 text-blue-500"
                                })
                            )
                        )
                    ),

                    React.createElement('div', {
                        className: "grid grid-cols-1 lg:grid-cols-2 gap-6"
                    },
                        
                        // Formulário para Nova Transação
                        React.createElement('div', {
                            className: "bg-white rounded-xl shadow-lg p-6"
                        },
                            React.createElement('h3', {
                                className: "text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2"
                            },
                                React.createElement(Plus, { className: "w-5 h-5" }),
                                "Nova Transação"
                            ),
                            
                            React.createElement('div', {
                                className: "space-y-4"
                            },
                                React.createElement('input', {
                                    type: "text",
                                    placeholder: "Descrição",
                                    value: newTransaction.description,
                                    onChange: (e) => setNewTransaction({...newTransaction, description: e.target.value}),
                                    className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                }),
                                
                                React.createElement('input', {
                                    type: "number",
                                    placeholder: "Valor",
                                    step: "0.01",
                                    value: newTransaction.amount,
                                    onChange: (e) => setNewTransaction({...newTransaction, amount: e.target.value}),
                                    className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                }),
                                
                                React.createElement('div', {
                                    className: "grid grid-cols-2 gap-4"
                                },
                                    React.createElement('select', {
                                        value: newTransaction.type,
                                        onChange: (e) => setNewTransaction({...newTransaction, type: e.target.value}),
                                        className: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    },
                                        React.createElement('option', { value: "expense" }, "Despesa"),
                                        React.createElement('option', { value: "income" }, "Receita")
                                    ),
                                    
                                    React.createElement('input', {
                                        type: "text",
                                        placeholder: "Categoria",
                                        value: newTransaction.category,
                                        onChange: (e) => setNewTransaction({...newTransaction, category: e.target.value}),
                                        className: "px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    })
                                ),
                                
                                React.createElement('input', {
                                    type: "date",
                                    value: newTransaction.date,
                                    onChange: (e) => setNewTransaction({...newTransaction, date: e.target.value}),
                                    className: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                }),
                                
                                React.createElement('button', {
                                    onClick: addTransaction,
                                    className: "w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors"
                                }, "Adicionar Transação")
                            )
                        ),

                        // Lista de Transações
                        React.createElement('div', {
                            className: "bg-white rounded-xl shadow-lg p-6"
                        },
                            React.createElement('h3', {
                                className: "text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2"
                            },
                                React.createElement(Calendar, { className: "w-5 h-5" }),
                                `Transações (${transactions.length})`
                            ),
                            
                            loading ? 
                                React.createElement('div', {
                                    className: "text-center py-8"
                                },
                                    React.createElement('div', {
                                        className: "loading-spinner rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"
                                    }),
                                    React.createElement('p', {
                                        className: "text-gray-600 mt-2"
                                    }, "Carregando...")
                                ) :
                                React.createElement('div', {
                                    className: "space-y-3 max-h-96 overflow-y-auto"
                                },
                                    transactions.length === 0 ?
                                        React.createElement('div', {
                                            className: "text-center py-8 text-gray-500"
                                        },
                                            React.createElement('p', {}, "Nenhuma transação encontrada"),
                                            React.createElement('p', {
                                                className: "text-sm mt-2"
                                            }, "Verifique a configuração da API e se a planilha contém dados")
                                        ) :
                                        transactions.slice(0, 10).map((transaction) =>
                                            React.createElement('div', {
                                                key: transaction.id,
                                                className: "flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                                            },
                                                React.createElement('div', {
                                                    className: "flex-1"
                                                },
                                                    React.createElement('p', {
                                                        className: "font-medium text-gray-800"
                                                    }, transaction.description),
                                                    React.createElement('div', {
                                                        className: "flex items-center gap-2 text-sm text-gray-600"
                                                    },
                                                        React.createElement('span', {}, formatDate(transaction.date)),
                                                        React.createElement('span', {}, "•"),
                                                        React.createElement('span', {
                                                            className: "bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs"
                                                        }, transaction.category)
                                                    )
                                                ),
                                                React.createElement('div', {
                                                    className: "text-right"
                                                },
                                                    React.createElement('p', {
                                                        className: `font-bold ${
                                                            transaction.type === 'receita' || transaction.type === 'income' || transaction.amount > 0
                                                                ? 'text-green-600' 
                                                                : 'text-red-600'
                                                        }`
                                                    }, 
                                                        (transaction.type === 'receita' || transaction.type === 'income' || transaction.amount > 0 ? '+' : '-') +
                                                        formatCurrency(transaction.amount)
                                                    )
                                                )
                                            )
                                        )
                                )
                        )
                    ),

                    // Configuração
                    React.createElement('div', {
                        className: "bg-yellow-50 border border-yellow-200 rounded-xl p-6"
                    },
                        React.createElement('h3', {
                            className: "text-lg font-semibold text-yellow-800 mb-2"
                        }, "⚙️ Configuração"),
                        React.createElement('div', {
                            className: "text-sm text-yellow-700 space-y-2"
                        },
                            React.createElement('p', {},
                                React.createElement('strong', {}, "1. "),
                                "Obtenha sua API Key no Google Cloud Console"
                            ),
                            React.createElement('p', {},
                                React.createElement('strong', {}, "2. "),
                                "Substitua 'SUA_API_KEY_AQUI' no código"
                            ),
                            React.createElement('p', {},
                                React.createElement('strong', {}, "3. "),
                                "Configure sua planilha como pública"
                            ),
                            React.createElement('p', {},
                                React.createElement('strong', {}, "ID da Planilha: "),
                                React.createElement('code', { className: "bg-yellow-100 px-1 rounded" }, SHEET_ID)
                            )
                        )
                    )
                )
            );
        };

        // Renderizar o componente
        ReactDOM.render(React.createElement(FinancialDashboard), document.getElementById('root'));
    </script>
</body>
</html>
